---

- name: Deploy Helm Operator
  command: "{{ item }}"
  with_items:
    - "helm upgrade --install helm-operator --values {{ kubernetes_helm_operator_values }} --namespace flux fluxcd/helm-operator"
  register: helm_operator_results
  environment:
    KUBECONFIG: "{{ REPO_ROOT }}/kubeconfig"
  changed_when: "'has been upgraded' in flux_results.stdout"
  until: "'has been upgraded' in flux_results.stdout"
  retries: 10
  delay: 10
