---

- name: rsyslog | copy configuration
  copy:
    content: |
      module(load="omprog")
      module(load="mmutf8fix")
      action(type="mmutf8fix" replacementChar="?")
      action(type="omfwd" protocol="tcp" target="{{ remote_syslog.ip }}" port="{{ remote_syslog.port }}" Template="RSYSLOG_SyslogProtocol23Format" TCP_Framing="octet-counted" KeepAlive="on")
    dest: /etc/rsyslog.d/50-promtail.conf
  notify: rsyslog configuration changed
  when: rsyslog.enabled is defined 
        and rsyslog.enabled

- name: rsyslog | start systemd service
  systemd:
    name: rsyslog
    enabled: true
    state: started
  when: rsyslog.enabled is defined 
        and rsyslog.enabled
